@page "/account/register/confirmemail/{UserId}/{Code}"
@inject IHttpClientFactory _httpClientFactory
@inject ISpinnerService _spinnerService
@inject IToastService _toastService

<PageHeaderComponent PageName="Email confirmation" Subtitle="Validating your email" />

@code {
    [Parameter]
    public string UserId { get; set; }

    [Parameter]
    public string Code { get; set; }

    protected override async Task OnInitializedAsync()
    {
        _spinnerService.ShowSpinner("Validation in progress...");

        object confirmEmailHolder = new
        {
            UserId = UserId,
            Code = Code
        };

        string uri = $"{Constants.APIControllers.ACCOUNT}/{Constants.AccountControllerEndpoints.CONFIRM_EMAIL}";

        var result = await _httpClientFactory.CreateClient(BlazorConstants.HttpClients.API).PutAsJsonAsync(uri, confirmEmailHolder);

        string message = null;

        if (result.IsSuccessStatusCode)
        {
            _toastService.ShowSuccessToast("Your email address has successfully been confirmed. It might take some time before Maurice confirms your account.", "Email confirmation complete");
        }
        else
        {
            message = await result.Content.ReadAsStringAsync();
        }

        _spinnerService.HideSpinner();

        await base.OnInitializedAsync();
    }
}
