@inject IDialogService _dialogService
@inject IToastService _toastService

<div class="custom-card custom-card-animated mb-5">
    <div class="e-card-content">
        <AuthorizeView Roles="@($"{Constants.Security.ADMINISTRATOR},{Constants.Security.PRIVILEGED_EMPLOYEE},{Constants.Security.EMPLOYEE}")">
            <Authorized>
                <div class="row justify-content-end" style="padding-right:16px; padding-bottom:16px;">
                    <SfButton IsPrimary="true" @onclick="EditCredit"><span class="oi oi-pencil" /></SfButton>
                    <SfButton @onclick="DeleteCredit"><span class="oi oi-trash" /></SfButton>
                </div>
            </Authorized>
        </AuthorizeView>
        
        <div class="row">
            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12" style="display: flex; justify-content: center;">
                <img src="@(Credit.LinkToImage)" style="max-width: 100%; object-fit: scale-down;"/>
            </div>

            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                @((MarkupString)Credit.Title)
                @((MarkupString)Credit.SubTitle)
                <b>Got from:</b>
                <p>@((MarkupString)Credit.GotFrom)</p>
                <b>Made By:</b>
                <p>@((MarkupString)Credit.MadeBy)</p>
                <b>Description:</b>
                <p>@((MarkupString)Credit.Description)</p>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public PLCredit Credit { get; set; }

    private bool isInEditMode;

    private const string splitterPaneCss = "theme";

    [Authorize(Roles =
        Constants.Security.ADMINISTRATOR + "," +
        Constants.Security.PRIVILEGED_EMPLOYEE + "," +
        Constants.Security.EMPLOYEE)]
    private void EditCredit()
    {
        isInEditMode = !isInEditMode;

        if (isInEditMode == true)
        {
            var parameters = new DialogParameters();
            parameters.Add("Credit", Credit);

            _dialogService.OnClose += DialogClosed;
            _dialogService.Show<EditCreditComponent>($"Edit {Credit.Title}" , parameters, new DialogOptions { HasHeader = true, HasButtons = true, HasCloseButton = true, HasBackgroundCancel = false, Width="75%" });
        }
    }

    private void DialogClosed(DialogResult dialogResult)
    {
        if(dialogResult.Cancelled == false)
        {
            _toastService.ShowSuccessToast(dialogResult.Data.ToString());
        }

        _dialogService.OnClose -= DialogClosed;
    }

    [Authorize(Roles =
        Constants.Security.ADMINISTRATOR + "," +
        Constants.Security.PRIVILEGED_EMPLOYEE + "," +
        Constants.Security.EMPLOYEE)]
    private void DeleteCredit()
    {

    }
}
